// SPDX-License-Identifier: GPL-2.0-or-later OR MIT
/* Copyright (c) 2020, Robert Marko <robert.marko@sartura.hr> */

/dts-v1/;
#include "ipq8074.dtsi"
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>

/ {
	#address-cells = <2>;
	#size-cells = <2>;
	model = "Xiaomi Mi AIoT Router AX3600";
	compatible = "xiaomi,ax3600", "qcom,ipq8074";
	interrupt-parent = <&intc>;

	aliases {
		serial0 = &blsp1_uart5;
		serial1 = &blsp1_uart3;
		led-boot = &led_system_yellow;
		led-failsafe = &led_system_yellow;
		led-running = &led_system_blue;
		led-upgrade = &led_system_yellow;
	};

	chosen {
		stdout-path = "serial0:115200n8";
		bootargs-append = " swiotlb=1 clk_ignore_unused";
	};

	keys {
		compatible = "gpio-keys";
		pinctrl-0 = <&button_pins>;
		pinctrl-names = "default";

		reset {
			label = "reset";
			gpios = <&tlmm 34 GPIO_ACTIVE_LOW>;
			linux,code = <KEY_RESTART>;
		};
	};

	leds {
		compatible = "gpio-leds";
		pinctrl-0 = <&led_pins>;
		pinctrl-names = "default";

		led_system_blue: system-blue {
			label = "blue:system";
			gpios = <&tlmm 42 GPIO_ACTIVE_HIGH>;
		};

		led_system_yellow: system-yellow {
			label = "yellow:system";
			gpios = <&tlmm 43 GPIO_ACTIVE_HIGH>;
		};

		network-yellow {
			label = "yellow:network";
			gpios = <&tlmm 22 GPIO_ACTIVE_HIGH>;
		};

		network-blue {
			label = "blue:network";
			gpios = <&tlmm 21 GPIO_ACTIVE_HIGH>;
		};

		aiot {
			label = "blue:aiot";
			gpios = <&tlmm 51 GPIO_ACTIVE_HIGH>;
		};
	};
};

&blsp1_uart3 {
	status = "okay";
};

&blsp1_uart5 {
	status = "okay";
};

&qpic_bam {
	status = "okay";
};

&qpic_nand {
	status = "okay";

	nand@0 {
		reg = <0>;
		nand-ecc-strength = <4>;
		nand-ecc-step-size = <512>;
		nand-bus-width = <8>;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			partition@0 {
				label = "0:SBL1";
				reg = <0x00000000 0x100000>;
				read-only;
			};

			partition@100000 {
				label = "0:MIBIB";
				reg = <0x00100000 0x100000>;
				read-only;
			};

			partition@200000 {
				label = "0:QSEE";
				reg = <0x00200000 0x300000>;
				read-only;
			};

			partition@500000 {
				label = "0:DEVCFG";
				reg = <0x00500000 0x80000>;
				read-only;
			};

			partition@580000 {
				label = "0:RPM";
				reg = <0x00580000 0x80000>;
				read-only;
			};

			partition@600000 {
				label = "0:CDT";
				reg = <0x00600000 0x80000>;
				read-only;
			};

			partition@680000 {
				label = "0:APPSBLENV";
				reg = <0x00680000 0x80000>;
			};

			partition@700000 {
				label = "0:APPSBL";
				reg = <0x00700000 0x100000>;
				read-only;
			};

			partition@800000 {
				label = "0:ART";
				reg = <0x00800000 0x80000>;
				read-only;
			};

			partition@880000 {
				label = "bdata";
				reg = <0x00880000 0x80000>;
				read-only;
			};

			partition@900000 {
				label = "crash";
				reg = <0x00900000 0x80000>;
				read-only;
			};

			partition@980000 {
				label = "crash_syslog";
				reg = <0x00980000 0x80000>;
				read-only;
			};

			partition@a00000 {
				label = "rootfs";
				reg = <0x00a00000 0x23c0000>;
			};

			partition@2dc0000 {
				label = "rootfs_1";
				reg = <0x02dc0000 0x23c0000>;
			};

			partition@5180000 {
				label = "overlay";
				reg = <0x05180000 0x1ec0000>;
			};

			partition@7040000 {
				label = "rsvd0";
				reg = <0x07040000 0x80000>;
			};
		};
	};
};

&tlmm {
	button_pins: button-pins {
		pins = "gpio34";
		function = "gpio";
		bias-pull-up;
		drive-strength = <8>;
	};

	led_pins: led-pins {
		pins = "gpio21", "gpio22", "gpio42", "gpio43", "gpio51";
		function = "gpio";
		bias-pull-down;
		drive-strength = <8>;
	};

	mdio_pins: mdio_pinmux {
		pinmux_1 {
			pins = "gpio69";
			function = "mdio";
		};

		pinmux_2 {
			pins = "gpio68";
			function = "mdc";
		};

		pinconf {
			pins = "gpio69", "gpio68";
			bias-pull-up;
		};
	};
};

&qmp_pcie_phy0 {
	status = "okay";
};

&pcie0 {
	status = "okay";

	perst-gpio = <&tlmm 52 GPIO_ACTIVE_HIGH>;

	bridge@0,0 {
		reg = <0x00000000 0 0 0 0>;
		#address-cells = <3>;
		#size-cells = <2>;
		ranges;

		wifi0: wifi@1,0 {
			status = "okay";

			compatible = "qcom,ath10k";
			reg = <0x00010000 0 0 0 0>;

			qcom,ath10k-calibration-variant = "Xiaomi-AX3600";
		};
	};
};

&mdio {
	status = "okay";

	pinctrl-0 = <&mdio_pins>;
	pinctrl-names = "default";
	reset-gpios = <&tlmm 37 GPIO_ACTIVE_LOW>;
	reset-delay-us = <2000>;
};

&wifi {
	status = "okay";
};
